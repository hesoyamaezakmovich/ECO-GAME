<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Эко-игры</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
            touch-action: none;
        }

        body {
            overscroll-behavior: none;
            background: #f0f2f5;
        }

        .game-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: white;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .game-content {
            padding-top: 140px;
            padding-bottom: 20px;
        }

        .item-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }

        .drag-handle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: #888;
        }

        .item-card.dragging {
            transform: scale(1.02);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .nav-button {
            font-size: 18px;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: bold;
        }

        .set-button {
            font-size: 16px;
            padding: 10px 20px;
            border-radius: 10px;
            margin: 0 5px;
        }

        .control-button {
            font-size: 18px;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: bold;
        }

        .emoji-large {
            font-size: 48px;
            margin: 10px 0;
        }

        .item-name {
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
        }

        .decomp-time {
            font-size: 16px;
            color: #16a34a;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Игра "Время разложения" -->
    <div id="decomposition" class="min-h-screen">
        <!-- Шапка с кнопками -->
        <div class="game-header">
            <div class="flex items-center justify-between mb-4">
                <button class="nav-button bg-gray-600 text-white" onclick="backToMenu()">
                    ← Назад
                </button>
                <div class="flex gap-2">
                    <button class="control-button bg-green-600 text-white" onclick="checkOrder()">
                        Проверить
                    </button>
                    <button class="control-button bg-blue-600 text-white" onclick="shuffleItems()">
                        Перемешать
                    </button>
                </div>
            </div>
            <div class="flex justify-center" id="set-buttons">
                <!-- Кнопки наборов будут добавлены через JavaScript -->
            </div>
        </div>

        <!-- Основной контент -->
        <div class="game-content" id="items-container">
            <!-- Карточки будут добавлены через JavaScript -->
        </div>
    </div>

    <script>
        // Те же базы данных CARD_SETS и WASTE_CATEGORIES

        function renderItems() {
            const container = document.getElementById('items-container');
            container.innerHTML = '';

            currentItems.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.dataset.index = index;
                card.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-1">
                            <div class="emoji-large">${item.emoji}</div>
                            <div class="item-name">${item.name}</div>
                            ${showTimes ? `<div class="decomp-time">${item.decompositionTime}</div>` : ''}
                        </div>
                        <div class="drag-handle">⋮⋮</div>
                    </div>
                `;

                setupDragListeners(card);
                container.appendChild(card);
            });
        }

        function setupDragListeners(card) {
            let startY = 0;
            let currentY = 0;
            let initialPosition = 0;
            
            card.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                initialPosition = card.offsetTop;
                card.classList.add('dragging');
            });

            card.addEventListener('touchmove', (e) => {
                currentY = e.touches[0].clientY;
                const deltaY = currentY - startY;
                
                // Ограничиваем движение карточки по вертикали
                const maxTop = window.innerHeight - card.offsetHeight;
                let newTop = initialPosition + deltaY;
                newTop = Math.max(0, Math.min(newTop, maxTop));
                
                card.style.transform = `translateY(${deltaY}px)`;

                // Находим ближайшую карточку для замены
                const cards = [...document.querySelectorAll('.item-card:not(.dragging)')];
                const cardBelow = cards.find(otherCard => {
                    const box = otherCard.getBoundingClientRect();
                    return currentY > box.top && currentY < box.bottom;
                });

                if (cardBelow) {
                    const draggedIndex = parseInt(card.dataset.index);
                    const targetIndex = parseInt(cardBelow.dataset.index);
                    
                    if (draggedIndex !== targetIndex) {
                        // Меняем порядок элементов
                        const item = currentItems[draggedIndex];
                        currentItems.splice(draggedIndex, 1);
                        currentItems.splice(targetIndex, 0, item);
                        renderItems();

                        // Восстанавливаем состояние перетаскивания
                        const newCard = document.querySelector(`[data-index="${targetIndex}"]`);
                        newCard.classList.add('dragging');
                        newCard.style.transform = `translateY(${deltaY}px)`;
                    }
                }
            });

            card.addEventListener('touchend', () => {
                card.classList.remove('dragging');
                card.style.transform = '';
            });
        }

        function initDecompositionGame() {
            const setButtonsContainer = document.getElementById('set-buttons');
            setButtonsContainer.innerHTML = '';
            
            Object.entries(CARD_SETS).forEach(([key, set]) => {
                const button = document.createElement('button');
                button.className = `set-button ${
                    currentSet === key ? 'bg-green-600 text-white' : 'bg-gray-200'
                }`;
                button.textContent = set.name;
                button.onclick = () => selectSet(key);
                setButtonsContainer.appendChild(button);
            });

            selectSet(currentSet);
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', () => {
            initDecompositionGame();
        });
    </script>
</body>
</html>